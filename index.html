<!doctype html>
<html>
    <head>
        <link rel="preload" href="04b30.woff2" as="font" type="font/woff2" crossorigin>
        <style>
            @font-face {
                font-family: '04b';
                src: url('04b30.woff2') format('woff2'),
                    url('04b30.woff') format('woff');
                font-weight: normal;
                font-style: normal;
                font-display: swap;
            }

            body {
                background-color: #1D1C1C
            }
            .start {
                cursor: pointer;
                color: #1D1C1C;
                padding: 15px 25px;
                border-radius: 10px;;
                font-family: '04b';
                font-size: 24px;
                margin-top: 40px;
                display: inline-block;
                background: #676052;
            }
            .start:hover {
                background: #A9A9A9;
            }
            h1 {
                text-align: center;
                font-family: '04b';
                color: #676052;
            }
            .container {
                margin: 0 auto;
                display: flex;
                width: 100%;
                justify-content: center;
            }
            .frame {
                width: 156px;
                height: 156px;
                position: absolute;
                top: 15px;
                left: 55px;
            }
            .frame-inner {
                background: url('frame.gif');
                background-repeat: no-repeat;
                background-size: cover;
                image-rendering: pixelated; 
                z-index: 4;
            }
            .frame-foreground {
                transform: translate(10px, 10px);
                width: 136px;
                height: 136px;
                background-color: #65747F;
                opacity: 0.5;
                z-index: 3;
            }
            .frame-background {
                transform: translate(10px, 10px);
                width: 136px;
                height: 136px;
                background-color: #65747F;
                z-index: 1;
            }
            .images {
                list-style-type: none;
                display: flex;
                flex-wrap: wrap;
                flex-direction: row;
                width: 726px;
            }
            .images li.flipped {
                transform: scaleX(-1);
            }
            .images li {
                display: block;
                transition: transform 0.3s ease;
                transition-delay: 0s;
                transform: scaleX(1);
                width: 176px;
                height: 136px;
                margin: 10px 0 10px 0;
                background-repeat: no-repeat;
                background-size: contain;
                background-position: center center;
                image-rendering: pixelated;
                z-index: 2;
            }
            .images-container {
                position: relative;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
        
        <script>
            function getRandomPhunk() {
                const id = Math.floor(Math.random()*10000).toString().padStart(4, '0')
                const url = `./original_punks_images/punk${id}.png`
                return url
            }

            const phunkToFrame = [
                [15, 55],
                [15, 225],
                [15, 405],
                [15, 580],
                [170, 580],
                [170, 405],
                [170, 225],
                [170, 55],
            ]

            let duration = 80, decay = 1.1
            let ticks = 8*3+Math.floor(Math.random()*8)
            function animateFrameTo(phunkOffset, duration) {
                const id = `#phunk${phunkOffset+1}`
                console.log('animateFrameTo', id, duration)
                const x = phunkToFrame[phunkOffset][0]
                const y = phunkToFrame[phunkOffset][1]

                $(".frame").each((index, elem) => {
                                    
                    $(elem).animate({
                        top: `${x}px`,
                        left: `${y}px`
                    }, duration, () => {
                        if (!elem.classList.contains("frame-inner")) return

                        phunkOffset++
                        if (phunkOffset > 7) {
                            phunkOffset = 0
                        }
                        ticks--
                        if (ticks > 0) {
                            animateFrameTo(phunkOffset, duration*decay)
                        }
                    })
                })
            }

            function startFrameAnimation() {
                animateFrameTo(0, duration)
            }

            window.onload = () => {
                
                $("#phunk1").css({
                    "background-image": `url(${getRandomPhunk()})`
                })

                $("#phunk2").css({
                    "background-image": `url(${getRandomPhunk()})`,
                })

                $("#phunk3").css({
                    "background-image": `url(${getRandomPhunk()})`
                })
                
                $("#phunk4").css({
                    "background-image": `url(${getRandomPhunk()})`
                })
                
                $("#phunk5").css({
                    "background-image": `url(${getRandomPhunk()})`
                })
                
                $("#phunk6").css({
                    "background-image": `url(${getRandomPhunk()})`
                })
                
                $("#phunk7").css({
                    "background-image": `url(${getRandomPhunk()})`
                })
                
                $("#phunk8").css({
                    "background-image": `url(${getRandomPhunk()})`
                })

                console.log($("#phunk1").position(), $("#phunk8").position())

                setInterval(() => {
                    const position = $(".frame-background").position()
                    console.log(Math.floor(position.top))
                    let x = null;
                    if (position.top === 25) {
                        if (position.left <= 165)  x = 1;
                        else if (position.left <= 325) x = 2;
                        else if (position.left <= 520) x = 3;
                        else x = 4;
                    } else if (position.top > 150) {
                        if (position.left >= 480)  x = 8;
                        else if (position.left >= 265) x = 7;
                        else if (position.left >= 125) x = 6;
                        else x = 5;
                    }
                    if (x) {
                        const id = `#phunk${x}`
                        $(".images li").removeClass("flipped")
                        $(id).addClass("flipped")
                        console.log(position, id)
                    }
                }, 1000/25)

                $(".start").click(() => {
                    $(".start").hide()
                    startFrameAnimation()
                })
            }
        </script>
    </head>
    <body>
        <h1>Free Philip lottery</h1>
            
        <div class="container">
            <div class="images-container">

                <div class="frame frame-inner">
                </div>
                <div class="frame frame-foreground">
                </div>
                <div class="frame frame-background">
                </div>                
                <ul class="images">
                    <li id="phunk1"></li>
                    <li id="phunk2"></li>
                    <li id="phunk3"></li>
                    <li id="phunk4"></li>
                    <li id="phunk5"></li>
                    <li id="phunk6"></li>
                    <li id="phunk7"></li>
                    <li id="phunk8"></li>
                </ul>
            </div>
        </div>

        <div style="text-align: center;">
            <a class="start">Start</a>
        </div>
    </body>
</html>